CREATE TABLE TAB_FATURAMENTO 
(DATA_VENDA DATE NULL, 
TOTAL_VENDA FLOAT);

SELECT * FROM TAB_FATURAMENTO;

SELECT * FROM NOTAS;
SELECT * FROM ITENS_NOTAS;

/* delimitador diz qual vai ser o caractere que dita quando a criação do TRIGGER vai acabar.
 Toda vez que se inserir alguma linha na tabela ITENS_NOTAS, ocorrerá a ação dentro do FOR EACH ROW BEGIN */
DELIMITER //
CREATE TRIGGER TG_CALCULA_FATURAMENTO_INSERT AFTER INSERT ON ITENS_NOTAS
FOR EACH ROW BEGIN 
  DELETE FROM TAB_FATURAMENTO;
  INSERT INTO TAB_FATURAMENTO 
  SELECT A.DATA_VENDA, SUM(B.QUANTIDADE * B.PRECO) AS TOTAL_VENDA FROM
  NOTAS A INNER JOIN ITENS_NOTAS B
  ON A.NUMERO = B.NUMERO
  GROUP BY A.DATA_VENDA;
END // 

/* ao inserir itens a tabela de itens_notas, é possível ver que 
o faturamento da tabela de faturamento aumenta devido ao trigger */
INSERT INTO NOTAS(NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ("0100", "2019-05-08", "1471156710", 235, 0.10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ("0100", "1000889", 100, 10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ("0100", "1002334", 100, 10);

INSERT INTO NOTAS(NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ("0101", "2019-05-08", "1471156710", 235, 0.10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ("0101", "1000889", 100, 10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ("0101", "1002334", 100, 10);

INSERT INTO NOTAS(NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ("0102", "2019-05-08", "1471156710", 235, 0.10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ("0102", "1000889", 100, 10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ("0102", "1002334", 100, 10);





